<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/templates/BasicTemplate.xhtml">

	<ui:define name="metadata">
		<f:metadata>
			<f:viewAction action="#{searchSalesController.initialize}" />
		</f:metadata>
	</ui:define>

	<ui:define name="content">
		<!-- 
		<script>
			function addMaintenance() {
				PF('stateButtom2').jq.click();
			}
		</script>
 -->
		<div class="title ui-widget-header ui-corner-all">
			<h:panelGrid columns="2" style="margin:auto;">
		BUSCAR VENTAS <h:form id="form0">
					<p:commandLink icon="ui-icon-document" ajax="false"
						action="#{loadSalesController.download}"
						value="(Descargar formato de trama)">
					</p:commandLink>
				</h:form>
			</h:panelGrid>

		</div>


		<h:panelGrid style="margin:auto;text-align:center;">
			<p:messages id="messages" showDetail="true"></p:messages>
		</h:panelGrid>

		<h:panelGrid style="margin:auto;">
			<h:form id="form">
				<h:panelGrid columns="3">
					<h:panelGrid columns="2">
						<p:outputLabel value="Tipo de busqueda:"></p:outputLabel>
						<p:selectOneMenu id="searchType"
							value="#{searchSalesController.searchTypeSelected}"
							required="true"
							requiredMessage="Debe seleccionar tipo de busqueda">
							<f:selectItem itemLabel="Seleccione..." itemValue="" />
							<f:selectItem itemLabel="Buscar por numero de tarjeta."
								itemValue="creditCard" />
							<f:selectItem itemLabel="Buscar por DNI responsable."
								itemValue="dni" />
							<f:selectItem itemLabel="Buscar por datos de venta."
								itemValue="saleData" />
							<f:selectItem itemLabel="Buscar por datos personales"
								itemValue="personalData" />
							<p:ajax immediate="true" process=":form:searchType"
								listener="#{searchSalesController.onChangeSearchType}"
								update=":form:searchTypeOut :messages"></p:ajax>
						</p:selectOneMenu>
					</h:panelGrid>
					<p:outputPanel id="searchTypeOut">
						<h:panelGrid columns="4"
							rendered="#{searchSalesController.searchByDateSaleRendered}">

							<p:outputLabel value="F. Venta Desde:"></p:outputLabel>
							<p:calendar navigator="true"
								value="#{searchSalesController.dateOfSaleStarted}"
								required="true"
								requiredMessage="Debe ingresar fecha venta desde:"
								pattern="dd-MM-yyyy"></p:calendar>

							<p:outputLabel value="F. Venta Hasta:"></p:outputLabel>
							<p:calendar navigator="true"
								value="#{searchSalesController.dateOfSaleEnded}" required="true"
								requiredMessage="Debe ingresar fecha venta hasta:"
								pattern="dd-MM-yyyy"></p:calendar>


							<p:outputLabel value="Banco:"></p:outputLabel>
							<p:selectOneMenu id="bank"
								value="#{searchSalesController.bankSelected}">
								<f:selectItem itemLabel="Seleccione..." itemValue="" />
								<f:selectItems value="#{searchSalesController.banks}"></f:selectItems>
							</p:selectOneMenu>

							<p:outputLabel value="Producto:"></p:outputLabel>
							<p:selectOneMenu id="product"
								value="#{searchSalesController.productSelected}">
								<f:selectItem itemLabel="Seleccione..." itemValue="" />
								<f:selectItems value="#{searchSalesController.products}"></f:selectItems>
							</p:selectOneMenu>

							<p:outputLabel value="F. Afiliacion"></p:outputLabel>
							<p:calendar navigator="true"
								value="#{searchSalesController.affiliationDate}"
								pattern="dd-MM-yyyy"></p:calendar>


							<p:outputLabel value="Estado:"></p:outputLabel>
							<p:selectOneMenu id="state"
								value="#{searchSalesController.saleStateSelected}">
								<f:selectItem itemLabel="Seleccione..." itemValue="" />
								<f:selectItems value="#{searchSalesController.saleStates}"></f:selectItems>
							</p:selectOneMenu>

						</h:panelGrid>

						<h:panelGrid columns="2"
							rendered="#{searchSalesController.searchByCreditCardNumberRendered}">

							<p:outputLabel value="NUM. TARJETA"></p:outputLabel>
							<p:inputText style="width: 120px;" required="true"
								requiredMessage="Debe ingresar NUM. TARJETA"
								value="#{searchSalesController.creditCardNumber}"></p:inputText>

						</h:panelGrid>

						<h:panelGrid columns="2"
							rendered="#{searchSalesController.searchByDocumentNumberResponsibleRendered}">
							<p:outputLabel value="DNI RESP."></p:outputLabel>
							<p:inputText style="width: 120px;" required="true"
								requiredMessage="Debe ingresar DNI RESP."
								value="#{searchSalesController.nuicResponsible}"></p:inputText>

						</h:panelGrid>


						<h:panelGrid columns="2"
							rendered="#{searchSalesController.searchByNamesRendered}">

							<p:outputLabel value="Tipo de persona:"></p:outputLabel>
							<p:selectOneMenu id="personType"
								value="#{searchSalesController.personTypeSelected}"
								required="true"
								requiredMessage="Debe seleccionar tipo de persona">
								<f:selectItem itemLabel="Seleccione..." itemValue="" />
								<f:selectItem itemLabel="Responsable" itemValue="responsible" />
								<f:selectItem itemLabel="Asegurado" itemValue="insured" />
								<f:selectItem itemLabel="Contratante" itemValue="contractor" />
								<p:ajax immediate="true"
									listener="#{searchSalesController.onChangePersonType}"
									update="@form"></p:ajax>
							</p:selectOneMenu>

						</h:panelGrid>

						<h:panelGrid columns="2"
							rendered="#{searchSalesController.searchByContractorRendered}">

							<p:outputLabel value="NUIC CONT."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.nuicContractor}"></p:inputText>

							<p:outputLabel value="AP. PATERNO CONT."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.lastnamePaternalContractor}"></p:inputText>

							<p:outputLabel value="AP. MATERNO CONT."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.lastnameMaternalContractor}"></p:inputText>

							<p:outputLabel value="NOMBRES CONT."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.firstnameContractor}"></p:inputText>

						</h:panelGrid>
						<h:panelGrid columns="2"
							rendered="#{searchSalesController.searchByInsuredRendered}">

							<p:outputLabel value="NUIC ASEG."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.nuicInsured}"></p:inputText>

							<p:outputLabel value="AP. PATERNO ASEG."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.lastnamePaternalInsured}"></p:inputText>

							<p:outputLabel value="AP. MATERNO ASEG."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.lastnameMaternalInsured}"></p:inputText>

							<p:outputLabel value="NOMBRES ASEG."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.firstnameInsured}"></p:inputText>
						</h:panelGrid>
						<h:panelGrid columns="2"
							rendered="#{searchSalesController.searchByResponsibleRendered}">

							<p:outputLabel value="NUIC RESP."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.nuicResponsible}"></p:inputText>

							<p:outputLabel value="AP. PATERNO RESP."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.lastnamePaternalResponsible}"></p:inputText>

							<p:outputLabel value="AP. MATERNO RESP."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.lastnameMaternalResponsible}"></p:inputText>

							<p:outputLabel value="NOMBRES RESP."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.firstnameResponsible}"></p:inputText>
						</h:panelGrid>
					</p:outputPanel>
				</h:panelGrid>
				<h:panelGrid columns="2" style="margin:auto;text-align:center;">
					<p:commandButton icon="ui-icon-search"
						actionListener="#{searchSalesController.search}" value="Buscar"
						process="@form"
						update=":form:searchTypeOut :formTable:searchTable :formTable:saleId :formTable:salesCount :messages">
					</p:commandButton>

					<p:commandButton action="#{searchSalesController.exportExcel}"
						value="Exportar a excel" process="@form" ajax="false">
					</p:commandButton>

				</h:panelGrid>
			</h:form>
		</h:panelGrid>



		<h:panelGrid columns="2" >

			<h:form id="formUpload" enctype="multipart/form-data;charset=UTF-8">
				<p:fileUpload id="inputFile" mode="advanced"
					widgetVar="inputFileSales" value="#{searchSalesController.file}"
					auto="true"
					update=":formUpload:inputFile :formUpload2:loadSaleButton :messages"
					fileUploadListener="#{searchSalesController.handleFileUpload}"
					label="Cargar Archivo" fileLimit="1">
				</p:fileUpload>
			</h:form>

			<h:form id="formUpload2">
				<h:panelGrid columns="2" style="width:100%;">
					<p:commandButton id="loadSaleButton" widgetVar="loadButton"
						disabled="#{searchSalesController.dataList==null}"
						value="Cargar #{searchSalesController.dataList!=null?searchSalesController.dataList.size():''} Ventas"
						process="@this" oncomplete="enableChoosing();"
						update=":formUpload2:loadSaleButton :formUpload2:pbLoadSales :formUpload:inputFile :messages"
						actionListener="#{searchSalesController.load}"
						onclick="PF('pbLoad').start();PF('loadButton').disable();disableChoosing();">
						<p:confirm header="Confirmación" message="¿Está seguro?"
							icon="ui-icon-alert" />
					</p:commandButton>
					<p:progressBar widgetVar="pbLoad" ajax="true" id="pbLoadSales" style="width:200px;"
						value="#{searchSalesController.progress}" labelTemplate="{value}%"
						styleClass="animated" global="false">
					</p:progressBar>
				</h:panelGrid>
			</h:form>

		</h:panelGrid>

		


			<h:form id="formTable">

				<h:panelGrid columns="2" style="width:100%;">
					<p:outputLabel id="saleId"
						value="Venta seleccionada: #{searchSalesController.saleSelected!=null?searchSalesController.saleSelected.code:''}">
					</p:outputLabel>
					<h:panelGrid style="width:100%;">
						<p:outputLabel id="salesCount"
							value="Se encontraron #{searchSalesController.sales!=null?searchSalesController.sales.size():'0'} ventas.">
						</p:outputLabel>
					</h:panelGrid>
				</h:panelGrid>

				
				<p:dataTable style="width:100%;" value="#{searchSalesController.sales}" var="s"
					scrollable="true" scrollWidth="100%" paginator="true" rows="10"
					selectionMode="single" 
					selection="#{searchSalesController.saleSelected}" rowKey="#{s.id}"
					id="searchTable">

					<p:ajax event="rowSelect" update=":formTable:saleId" />
					<p:ajax event="rowUnselect" update=":formTable:saleId" />


					<p:column headerText="CODIGO" width="100">
						<h:outputText value="#{s.code}"></h:outputText>
					</p:column>

					<p:column headerText="TIPO DE DOCUMENTO" width="80">
						<h:outputText value="#{s.documentType}"></h:outputText>
					</p:column>

					<p:column headerText="NUIC RESP PAGO" width="80">
						<h:outputText value="#{s.payer.nuicResponsible}"></h:outputText>
					</p:column>

					<p:column headerText="AP PAT RESP PAGO" width="80">
						<h:outputText value="#{s.payer.lastnamePaternalResponsible}"></h:outputText>
					</p:column>

					<p:column headerText="AP MAT RESP PAGO" width="80">
						<h:outputText value="#{s.payer.lastnameMaternalResponsible}"></h:outputText>
					</p:column>

					<p:column headerText="NOMBRES RESP PAGO" width="80">
						<h:outputText value="#{s.payer.firstnameResponsible}"></h:outputText>
					</p:column>

					<p:column headerText="N° TARJETA DE CREDITO" width="100">
						<h:outputText value="#{s.creditCard.number}"></h:outputText>
					</p:column>

					<p:column headerText="N° DE CUENTA" width="80">
						<h:outputText value="#{s.accountNumber}"></h:outputText>
					</p:column>

					<p:column headerText="FECHA VENC TARJETA" width="80">
						<h:outputText value="#{s.creditCard.expirationDate}">
							<f:convertDateTime pattern="MM/yyyy" />
						</h:outputText>
					</p:column>

					<p:column headerText="ESTADO" width="80">
						<h:outputText value="#{s.creditCard.state}"></h:outputText>
					</p:column>

					<p:column headerText="DIAS MORA" width="80">
						<h:outputText value="#{s.creditCard.daysOfDefault}"></h:outputText>
					</p:column>



					<p:column headerText="NUIC CONTRATANTE" width="80">
						<h:outputText value="#{s.nuicContractor}"></h:outputText>
					</p:column>

					<p:column headerText="AP PAT CONTRATANTE" width="80">
						<h:outputText value="#{s.lastnamePaternalContractor}"></h:outputText>
					</p:column>

					<p:column headerText="AP MAT CONTRATANTE" width="80">
						<h:outputText value="#{s.lastnameMaternalContractor}"></h:outputText>
					</p:column>

					<p:column headerText="NOMBRES CONTRATANTE" width="80">
						<h:outputText value="#{s.firstnameContractor}"></h:outputText>
					</p:column>


					<p:column headerText="NUIC ASEGURADO" width="80">
						<h:outputText value="#{s.nuicInsured}"></h:outputText>
					</p:column>

					<p:column headerText="AP PAT ASEGURADO" width="80">
						<h:outputText value="#{s.lastnamePaternalInsured}"></h:outputText>
					</p:column>

					<p:column headerText="AP MAT ASEGURADO" width="80">
						<h:outputText value="#{s.lastnameMaternalInsured}"></h:outputText>
					</p:column>

					<p:column headerText="NOMBRES ASEGURADO" width="80">
						<h:outputText value="#{s.firstnameInsured}"></h:outputText>
					</p:column>

					<p:column headerText="TELEFONO 1" width="80">
						<h:outputText value="#{s.phone1}"></h:outputText>
					</p:column>

					<p:column headerText="TELEFONO 2" width="80">
						<h:outputText value="#{s.phone2}"></h:outputText>
					</p:column>

					<p:column headerText="CORREO" width="120">
						<h:outputText value="#{s.payer.mail}"></h:outputText>
					</p:column>

					<p:column headerText="DEPARTAMENTO" width="80">
						<h:outputText value="#{s.payer.department}"></h:outputText>
					</p:column>

					<p:column headerText="PROVINCIA" width="80">
						<h:outputText value="#{s.payer.province}"></h:outputText>
					</p:column>

					<p:column headerText="DISTRITO" width="80">
						<h:outputText value="#{s.payer.district}"></h:outputText>
					</p:column>

					<p:column headerText="DIRECCION" width="80"
						style="white-space:nowrap;">
						<h:outputText value="#{s.payer.address}"></h:outputText>
					</p:column>






					<p:column headerText="FECHA DE VENTA" width="80">
						<h:outputText value="#{s.dateOfSale}" width="80">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>

					<p:column headerText="CANAL DE VENTA" width="80">
						<h:outputText value="#{s.channelOfSale}"></h:outputText>
					</p:column>

					<p:column headerText="LUGAR DE VENTA" width="80">
						<h:outputText value="#{s.placeOfSale}"></h:outputText>
					</p:column>

					<p:column headerText="CODIGO DE VENDEDOR" width="80">
						<h:outputText value="#{s.vendorCode}"></h:outputText>
					</p:column>

					<p:column headerText="NOMBRE DE VENDEDOR" width="80">
						<h:outputText value="#{s.vendorName}"></h:outputText>
					</p:column>

					<p:column headerText="# DE POLIZA" width="80">
						<h:outputText value="#{s.policyNumber}"></h:outputText>
					</p:column>

					<p:column headerText="# DE CERTIFICADO" width="80">
						<h:outputText value="#{s.certificateNumber}"></h:outputText>
					</p:column>

					<p:column headerText="# DE PROPUESTA" width="80">
						<h:outputText value="#{s.proposalNumber}"></h:outputText>
					</p:column>

					<p:column headerText="CODIGO DE COMERCIO" width="80">
						<h:outputText value="#{s.commerce.code}"></h:outputText>
					</p:column>


					<p:column headerText="PRODUCTO" width="80">
						<h:outputText value="#{s.commerce.product.name}"></h:outputText>
					</p:column>

					<p:column headerText="DESCRIPCION DE PRODUCTO" width="80">
						<h:outputText value="#{s.productDescription}"></h:outputText>
					</p:column>

					<p:column headerText="PERIODO DE COBRO" width="80">
						<h:outputText value="#{s.collectionPeriod}"></h:outputText>
					</p:column>

					<p:column headerText="TIPO DE COBRO" width="80">
						<h:outputText value="#{s.collectionType}"></h:outputText>
					</p:column>

					<p:column headerText="MEDIO DE PAGO" width="80">
						<h:outputText value="#{s.commerce.paymentMethod.name}"></h:outputText>
					</p:column>

					<p:column headerText="PRIMA" width="80">
						<h:outputText value="#{s.insurancePremium}"></h:outputText>
					</p:column>

					<p:column headerText="FECHA DE AUDITORIA" width="80">
						<h:outputText value="#{s.auditDate}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>

					<p:column headerText="USUARIO DE AUDITORIA" width="80">
						<h:outputText value="#{s.auditUser}"></h:outputText>
					</p:column>

					<p:column headerText="ESTADO" width="80">
						<h:outputText value="#{s.saleState.state.name}"></h:outputText>
					</p:column>

					<p:column headerText="FECHA ESTADO" width="80">
						<h:outputText value="#{s.saleState.date}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>

					<p:column headerText="USUARIO ESTADO" width="80">
						<h:outputText value="#{s.saleState.downUser}"></h:outputText>
					</p:column>

					<p:column headerText="CANAL ESTADO" width="80">
						<h:outputText value="#{s.saleState.downChannel}"></h:outputText>
					</p:column>

					<p:column headerText="MOTIVO ESTADO" width="80">
						<h:outputText value="#{s.saleState.downReason}"></h:outputText>
					</p:column>

					<p:column headerText="OBSERVACIONES ESTADO" width="80"
						style="white-space:nowrap;">
						<h:outputText value="#{s.saleState.downObservation}"></h:outputText>
					</p:column>

					<p:column headerText="FECHA ACT TC" width="80">
						<h:outputText value="#{s.creditCard.updateDate}" width="80">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>

					<p:column headerText="AFILIADO" width="80">
						<h:outputText value="#{s.affiliation==true?'Si':'No'}" width="80">
						</h:outputText>
					</p:column>

					<p:column headerText="FECHA DE AFILIACION" width="80">
						<h:outputText value="#{s.affiliationDate}" width="80">
							<f:convertDateTime pattern="dd/MM/yyyy hh:mm:ss" />
						</h:outputText>
					</p:column>

					<p:column headerText="AFILIADO USUARIO" width="80">
						<h:outputText value="#{s.affiliationUser.username}" width="80">
						</h:outputText>
					</p:column>

					<p:column headerText="BANCO" width="80">
						<h:outputText value="#{s.commerce.bank.name}"></h:outputText>
					</p:column>


					<p:column headerText="FECHA CREACION" width="80">
						<h:outputText value="#{s.createdAt}">
							<f:convertDateTime pattern="dd-MM-yyyy hh:mm:ss a" />
						</h:outputText>
					</p:column>

					<p:column headerText="USUARIO CREACION" width="80">
						<h:outputText value="#{s.createdBy.username}"></h:outputText>
					</p:column>



				</p:dataTable>

			</h:form>


		


		<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
			<p:commandButton value="Sí" type="button"
				styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
			<p:commandButton value="No" type="button"
				styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
		</p:confirmDialog>



		<script type="text/javascript">
			function disableChoosing() {
				PF('inputFileSales').disableButton(
						PF('inputFileSales').chooseButton);
				PF('inputFileSales').chooseButton.find('input[type="file"]')
						.attr('disabled', 'disabled');
			}

			function enableChoosing() {
				if (!PF('inputFileSales').files.length) {
					PF('inputFileSales').enableButton(
							PF('inputFileSales').chooseButton);
					PF('inputFileSales').chooseButton
							.find('input[type="file"]').removeAttr('disabled');
				}
			}
		</script>

	</ui:define>

</ui:composition>
</html>
