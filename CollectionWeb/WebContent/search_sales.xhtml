<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/templates/BasicTemplate.xhtml">

	<ui:define name="metadata">
		<f:metadata>
			<f:viewAction action="#{searchSalesController.initialize}" />
		</f:metadata>
	</ui:define>

	<ui:define name="content">
		<!-- 
		<script>
			function addMaintenance() {
				PF('stateButtom2').jq.click();
			}
		</script>
 -->

		<!-- 
		<h:outputScript name="jsf.js" library="javax.faces" target="head" />
		<h:outputScript name="jquery-ui.min.js" library="jquery-ui-1.11.4" target="head" />
		<h:outputStylesheet name="jquery-ui.min.css" library="jquery-ui-1.11.4" ></h:outputStylesheet>
		<h:outputScript name="datepicker.js" library="js" target="body" />
		 -->

		<div class="title ui-widget-header ui-corner-all">
			<h:panelGrid columns="2" style="margin:auto;">
		BUSCAR VENTAS 
			</h:panelGrid>

		</div>

		<h:panelGrid style="margin:auto;text-align:center;">
			<p:messages id="messages" showDetail="true"></p:messages>
		</h:panelGrid>

		<h:panelGrid style="margin:auto;">
			<h:form id="form" prependId="false">


				<h:panelGrid columns="3">
					<h:panelGrid columns="2">
						<p:outputLabel value="Tipo Búsqueda:"></p:outputLabel>
						<p:selectOneMenu id="searchType"
							value="#{searchSalesController.searchTypeSelected}"
							required="true"
							requiredMessage="Debe seleccionar tipo de búsqueda">
							<f:selectItem itemLabel="Seleccione..." itemValue="" />
							<f:selectItems value="#{searchSalesController.searchTypes}"></f:selectItems>
							<p:ajax
								update=":form:searchDataOut :form:personalDataOut :messages"></p:ajax>
						</p:selectOneMenu>
					</h:panelGrid>
					<h:panelGroup id="searchDataOut">
						<h:panelGrid columns="4"
							rendered="#{searchSalesController.searchTypeSelected=='saleData'}">

							<p:outputLabel value="F. Venta Desde:"></p:outputLabel>
							<p:calendar navigator="true"
								value="#{searchSalesController.dateOfSaleStarted}"
								required="true"
								requiredMessage="Debe ingresar fecha venta desde:"
								pattern="dd-MM-yyyy"></p:calendar>


							<p:outputLabel value="F. Venta Hasta:"></p:outputLabel>
							<p:calendar navigator="true"
								value="#{searchSalesController.dateOfSaleEnded}" required="true"
								requiredMessage="Debe ingresar fecha venta hasta:"
								pattern="dd-MM-yyyy"></p:calendar>


							<p:outputLabel value="Banco:"></p:outputLabel>
							<p:selectOneMenu id="bank"
								value="#{searchSalesController.bankSelected}">
								<f:selectItem itemLabel="Seleccione..." itemValue="" />
								<f:selectItems value="#{searchSalesController.banks}"></f:selectItems>
							</p:selectOneMenu>

							<p:outputLabel value="Producto:"></p:outputLabel>
							<p:selectOneMenu id="product"
								value="#{searchSalesController.productSelected}">
								<f:selectItem itemLabel="Seleccione..." itemValue="" />
								<f:selectItems value="#{searchSalesController.products}"></f:selectItems>
							</p:selectOneMenu>

							<p:outputLabel value="Estado:"></p:outputLabel>
							<p:selectOneMenu id="state"
								value="#{searchSalesController.saleStateSelected}">
								<f:selectItem itemLabel="Seleccione..." itemValue="" />
								<f:selectItems value="#{searchSalesController.saleStates}"></f:selectItems>
							</p:selectOneMenu>

						</h:panelGrid>


						<h:panelGrid columns="2"
							rendered="#{searchSalesController.searchTypeSelected=='creditCard'}">

							<p:outputLabel value="Número Tarjeta"></p:outputLabel>
							<p:inputText style="width: 120px;" required="true"
								requiredMessage="Debe ingresar Número Tarjeta"
								value="#{searchSalesController.creditCardNumber}"></p:inputText>

						</h:panelGrid>

						<h:panelGrid columns="2"
							rendered="#{searchSalesController.searchTypeSelected=='dni'}">
							<p:outputLabel value="DNI Responsable Pago"></p:outputLabel>
							<p:inputText style="width: 120px;" required="true"
								requiredMessage="Debe ingresar DNI Responsable Pago"
								value="#{searchSalesController.nuicResponsible}"></p:inputText>

						</h:panelGrid>

						<h:panelGrid columns="2"
							rendered="#{searchSalesController.searchTypeSelected=='personalData'}">
							<p:outputLabel value="Tipo Persona:"></p:outputLabel>
							<p:selectOneMenu id="personType"
								value="#{searchSalesController.personTypeSelected}">
								<f:selectItem itemLabel="Seleccione..." itemValue="" />
								<f:selectItems value="#{searchSalesController.personTypes}"></f:selectItems>
								<p:ajax process="@this :form:personType"
									update=":form:personalDataOut :messages"></p:ajax>
							</p:selectOneMenu>

						</h:panelGrid>

					</h:panelGroup>






					<h:panelGroup id="personalDataOut">

						<h:panelGrid columns="2"
							rendered="#{searchSalesController.personTypeSelected=='contractor' and searchSalesController.searchTypeSelected=='personalData'}">

							<p:outputLabel value="NUIC CONT."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.nuicContractor}"></p:inputText>

							<p:outputLabel value="AP. PATERNO CONT."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.lastnamePaternalContractor}"></p:inputText>

							<p:outputLabel value="AP. MATERNO CONT."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.lastnameMaternalContractor}"></p:inputText>

							<p:outputLabel value="NOMBRES CONT."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.firstnameContractor}"></p:inputText>

						</h:panelGrid>



						<h:panelGrid columns="2"
							rendered="#{searchSalesController.personTypeSelected=='insured' and searchSalesController.searchTypeSelected=='personalData'}">

							<p:outputLabel value="NUIC ASEG."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.nuicInsured}"></p:inputText>

							<p:outputLabel value="AP. PATERNO ASEG."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.lastnamePaternalInsured}"></p:inputText>

							<p:outputLabel value="AP. MATERNO ASEG."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.lastnameMaternalInsured}"></p:inputText>

							<p:outputLabel value="NOMBRES ASEG."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.firstnameInsured}"></p:inputText>
						</h:panelGrid>
						<h:panelGrid columns="2"
							rendered="#{searchSalesController.personTypeSelected=='responsible' and searchSalesController.searchTypeSelected=='personalData'}">

							<p:outputLabel value="NUIC RESP."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.nuicResponsible}"></p:inputText>

							<p:outputLabel value="AP. PATERNO RESP."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.lastnamePaternalResponsible}"></p:inputText>

							<p:outputLabel value="AP. MATERNO RESP."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.lastnameMaternalResponsible}"></p:inputText>

							<p:outputLabel value="NOMBRES RESP."></p:outputLabel>
							<p:inputText style="width: 230px;"
								value="#{searchSalesController.firstnameResponsible}"></p:inputText>
						</h:panelGrid>
					</h:panelGroup>


				</h:panelGrid>
				<h:panelGrid columns="2" style="margin:auto;text-align:center;">
					<p:commandButton actionListener="#{searchSalesController.search}"
						value="Buscar" process="@form" update=":formTable:searchTable :formTable:saleId :formTable:salesCount :messages">
					</p:commandButton>

					<p:commandButton action="#{searchSalesController.exportTxt}"
						value="Exportar a Txt" process="@form" ajax="false">
					</p:commandButton>

				</h:panelGrid>


			</h:form>
		</h:panelGrid>

		<h:form id="formTable" prependId="false">

			<h:panelGrid columns="2" style="width:100%;">
				<p:outputLabel id="saleId"
					value="Venta seleccionada: #{searchSalesController.saleSelected!=null?searchSalesController.saleSelected.code:''}">
				</p:outputLabel>
				<h:panelGrid style="width:100%;">
					<p:outputLabel id="salesCount"
						value="Se encontraron #{searchSalesController.salesCount} ventas.">
					</p:outputLabel>
				</h:panelGrid>
			</h:panelGrid>


			<p:dataTable style="width:100%;" lazy="true"
				paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} 
{CurrentPageReport} {NextPageLink} {LastPageLink}"
				value="#{searchSalesController.sales}" var="s" paginator="true"
				rows="10" id="searchTable">

				<p:column headerText="CODIGO" width="100">
					<h:outputText value="#{s.code}"></h:outputText>
				</p:column>

				<p:column headerText="TIPO DE DOCUMENTO" width="80">
					<h:outputText value="#{s.payer.documentType.name}"></h:outputText>
				</p:column>

				<p:column headerText="NUIC RESP PAGO" width="80">
					<h:outputText value="#{s.payer.nuicResponsible}"></h:outputText>
				</p:column>

				<p:column headerText="AP PAT RESP PAGO" width="80">
					<h:outputText value="#{s.payer.lastnamePaternalResponsible}"></h:outputText>
				</p:column>

				<p:column headerText="AP MAT RESP PAGO" width="80">
					<h:outputText value="#{s.payer.lastnameMaternalResponsible}"></h:outputText>
				</p:column>

				<p:column headerText="NOMBRES RESP PAGO" width="80">
					<h:outputText value="#{s.payer.firstnameResponsible}"></h:outputText>
				</p:column>

				<p:column headerText="N° TARJETA DE CREDITO" width="100">
					<h:outputText value="#{s.creditCard.number}"></h:outputText>
				</p:column>

				<p:column headerText="N° DE CUENTA" width="80">
					<h:outputText value="#{s.accountNumber}"></h:outputText>
				</p:column>

				<p:column headerText="FECHA VENC TARJETA" width="80">
					<h:outputText value="#{s.creditCard.expirationDate}">
						<f:convertDateTime pattern="MM/yyyy" />
					</h:outputText>
				</p:column>

				<p:column headerText="ESTADO TC" width="80">
					<h:outputText value="#{s.creditCard.state}"></h:outputText>
				</p:column>

				<p:column headerText="DIAS MORA" width="80">
					<h:outputText value="#{s.creditCard.daysOfDefault}"></h:outputText>
				</p:column>

				<p:column headerText="NUIC CONTRATANTE" width="80">
					<h:outputText value="#{s.nuicContractor}"></h:outputText>
				</p:column>

				<p:column headerText="AP PAT CONTRATANTE" width="80">
					<h:outputText value="#{s.lastnamePaternalContractor}"></h:outputText>
				</p:column>

				<p:column headerText="AP MAT CONTRATANTE" width="80">
					<h:outputText value="#{s.lastnameMaternalContractor}"></h:outputText>
				</p:column>

				<p:column headerText="NOMBRES CONTRATANTE" width="80">
					<h:outputText value="#{s.firstnameContractor}"></h:outputText>
				</p:column>

				<p:column headerText="NUIC ASEGURADO" width="80">
					<h:outputText value="#{s.nuicInsured}"></h:outputText>
				</p:column>

				<p:column headerText="AP PAT ASEGURADO" width="80">
					<h:outputText value="#{s.lastnamePaternalInsured}"></h:outputText>
				</p:column>

				<p:column headerText="AP MAT ASEGURADO" width="80">
					<h:outputText value="#{s.lastnameMaternalInsured}"></h:outputText>
				</p:column>

				<p:column headerText="NOMBRES ASEGURADO" width="80">
					<h:outputText value="#{s.firstnameInsured}"></h:outputText>
				</p:column>

				<p:column headerText="TELEFONO 1" width="80">
					<h:outputText value="#{s.phone1}"></h:outputText>
				</p:column>

				<p:column headerText="TELEFONO 2" width="80">
					<h:outputText value="#{s.phone2}"></h:outputText>
				</p:column>

				<p:column headerText="CORREO" width="120">
					<h:outputText value="#{s.payer.mail}"></h:outputText>
				</p:column>

				<p:column headerText="DEPARTAMENTO" width="80">
					<h:outputText value="#{s.payer.department}"></h:outputText>
				</p:column>

				<p:column headerText="PROVINCIA" width="80">
					<h:outputText value="#{s.payer.province}"></h:outputText>
				</p:column>

				<p:column headerText="DISTRITO" width="80">
					<h:outputText value="#{s.payer.district}"></h:outputText>
				</p:column>

				<p:column headerText="DIRECCION" width="80"
					style="white-space:nowrap;">
					<h:outputText value="#{s.payer.address}"></h:outputText>
				</p:column>

				<p:column headerText="FECHA DE VENTA" width="80">
					<h:outputText value="#{s.date}" width="80">
						<f:convertDateTime pattern="dd/MM/yyyy" />
					</h:outputText>
				</p:column>

				<p:column headerText="CANAL DE VENTA" width="80">
					<h:outputText value="#{s.channel}"></h:outputText>
				</p:column>

				<p:column headerText="LUGAR DE VENTA" width="80">
					<h:outputText value="#{s.place}"></h:outputText>
				</p:column>

				<p:column headerText="CODIGO DE VENDEDOR" width="80">
					<h:outputText value="#{s.vendorCode}"></h:outputText>
				</p:column>

				<p:column headerText="NOMBRE DE VENDEDOR" width="80">
					<h:outputText value="#{s.vendorName}"></h:outputText>
				</p:column>

				<p:column headerText="# DE POLIZA" width="80">
					<h:outputText value="#{s.policyNumber}"></h:outputText>
				</p:column>

				<p:column headerText="# DE CERTIFICADO" width="80">
					<h:outputText value="#{s.certificateNumber}"></h:outputText>
				</p:column>

				<p:column headerText="# DE PROPUESTA" width="80">
					<h:outputText value="#{s.proposalNumber}"></h:outputText>
				</p:column>

				<p:column headerText="CODIGO DE COMERCIO" width="80">
					<h:outputText value="#{s.commerceCode}"></h:outputText>
				</p:column>


				<p:column headerText="PRODUCTO" width="80">
					<h:outputText value="#{s.product.name}"></h:outputText>
				</p:column>

				<p:column headerText="DESCRIPCION DE PRODUCTO" width="80">
					<h:outputText value="#{s.productDescription}"></h:outputText>
				</p:column>

				<p:column headerText="PERIODO DE COBRO" width="80">
					<h:outputText value="#{s.collectionPeriod.name}"></h:outputText>
				</p:column>

				<p:column headerText="TIPO DE COBRO" width="80">
					<h:outputText value="#{s.collectionType}"></h:outputText>
				</p:column>

				<p:column headerText="BANCO" width="80">
					<h:outputText value="#{s.bank.name}"></h:outputText>
				</p:column>

				<p:column headerText="PRIMA" width="80">
					<h:outputText value="#{s.insurancePremium}"></h:outputText>
				</p:column>

				<p:column headerText="FECHA DE AUDITORIA" width="80">
					<h:outputText value="#{s.auditDate}">
						<f:convertDateTime pattern="dd/MM/yyyy" />
					</h:outputText>
				</p:column>

				<p:column headerText="USUARIO DE AUDITORIA" width="80">
					<h:outputText value="#{s.auditUser}"></h:outputText>
				</p:column>

				<p:column headerText="ESTADO" width="80">
					<h:outputText value="#{s.saleState.state.name}"></h:outputText>
				</p:column>

				<p:column headerText="FECHA ESTADO" width="80">
					<h:outputText value="#{s.saleState.date}">
						<f:convertDateTime pattern="dd/MM/yyyy" />
					</h:outputText>
				</p:column>

				<p:column headerText="USUARIO ESTADO" width="80">
					<h:outputText value="#{s.saleState.user}"></h:outputText>
				</p:column>

				<p:column headerText="CANAL ESTADO" width="80">
					<h:outputText value="#{s.saleState.channel}"></h:outputText>
				</p:column>

				<p:column headerText="MOTIVO ESTADO" width="80">
					<h:outputText value="#{s.saleState.reason}"></h:outputText>
				</p:column>

				<p:column headerText="OBSERVACIONES ESTADO" width="80"
					style="white-space:nowrap;">
					<h:outputText value="#{s.saleState.observation}"></h:outputText>
				</p:column>

				<p:column headerText="FECHA ACT TC" width="80">
					<h:outputText value="#{s.creditCard.date}" width="80">
						<f:convertDateTime pattern="dd/MM/yyyy" />
					</h:outputText>
				</p:column>

				<p:column headerText="LOTE" width="80">
					<h:outputText value="#{s.lote.name}">
					</h:outputText>
				</p:column>

				<p:column headerText="FECHA CREACION" width="80">
					<h:outputText value="#{s.createdAt}">
						<f:convertDateTime pattern="dd-MM-yyyy hh:mm:ss a" />
					</h:outputText>
				</p:column>

				<p:column headerText="USUARIO CREACION" width="80">
					<h:outputText value="#{s.createdBy.username}"></h:outputText>
				</p:column>

			</p:dataTable>

		</h:form>

		<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
			<p:commandButton value="Sí" type="button"
				styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
			<p:commandButton value="No" type="button"
				styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
		</p:confirmDialog>



		<script type="text/javascript">
			function disableChoosing() {
				PF('inputFileSales').disableButton(
						PF('inputFileSales').chooseButton);
				PF('inputFileSales').chooseButton.find('input[type="file"]')
						.attr('disabled', 'disabled');
			}

			function enableChoosing() {
				if (!PF('inputFileSales').files.length) {
					PF('inputFileSales').enableButton(
							PF('inputFileSales').chooseButton);
					PF('inputFileSales').chooseButton
							.find('input[type="file"]').removeAttr('disabled');
				}

			}

			function handleError(data) {
				if (null == data) {
					console.log("data is null");
				}
				/*console.log("Error Description: " + data.description);
				console.log("Error Name: " + data.errorName);
				console.log("Error errorMessage: " + data.errorMessage);
				console.log("httpError: " + data.httpError);
				console.log("emptyResponse: " + data.emptyResponse);
				console.log("maleformed: " + data.maleformed);
				console.log("serverError: " + data.serverError);*/
				var errorName = data.responseXML.evaluate('//error/error-name',
						data.responseXML, null, XPathResult.STRING_TYPE, null);
				var message = 'AJAX Exception';
				message += '\nSource: ' + data.source.id;
				message += '\nValue:' + data.source.value;
				message += '\nError: ' + errorName.stringValue;
				message += '\nMessage: ' + data.errorMessage;
				alert(message);

			}

			function handleAjax(data) {
				if (null == data) {
					console.log("data is null");
				}

				console.log("Status: " + data.status);
				console.log("Source id: " + data.source.id);
				console.log("Source value: " + data.source.value);

				var status = data.status;
				switch (status) {
				case "begin":
					// This is the start of the AJAX request.
					//TODO Take action here.
					break;
				case "complete":
					// This is invoked right after AJAX response is returned.
					//TODO Take action here.
					break;
				case "success":
					// This is invoked right after successful processing of AJAX response and update of HTML DOM.
					console.log("The AJAX responseCode was:  "
							+ data.responseCode);
					//TODO Take Additional actions.
					break;
				}

			}
		</script>




	</ui:define>

</ui:composition>
</html>
