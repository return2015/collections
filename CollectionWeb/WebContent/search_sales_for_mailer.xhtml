<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/templates/BasicTemplate.xhtml">

	<ui:define name="content">
<!-- 
		<script>
			function addMaintenance() {

				PF('stateButtom2').jq.click();

			}
		</script>
 -->
		<div class="title ui-widget-header ui-corner-all">
			<h:panelGrid style="margin:auto;">
		BUSCAR VENTAS
		</h:panelGrid>

		</div>

		<h:form id="form">



			<h:panelGrid style="margin:auto;">

				<h:panelGrid style="margin:auto;text-align:center;">
					<p:messages id="messages"></p:messages>
				</h:panelGrid>


				<h:panelGrid columns="3">

					<h:panelGrid columns="2">
						<p:outputLabel value="Tipo de busqueda:"></p:outputLabel>
						<p:selectOneMenu id="searchType"
							value="#{searchSaleForMailerController.searchTypeSelected}"
							required="true"
							requiredMessage="Debe seleccionar tipo de busqueda">
							<f:selectItem itemLabel="Seleccione..." itemValue="" />
							<f:selectItem itemLabel="Buscar por numero de tarjeta."
								itemValue="creditCard" />
							<f:selectItem itemLabel="Buscar por DNI responsable."
								itemValue="dni" />
							<f:selectItem itemLabel="Buscar por datos de venta."
								itemValue="saleData" />
							<f:selectItem itemLabel="Buscar por datos personales"
								itemValue="personalData" />
							<p:ajax immediate="true"
								listener="#{searchSaleForMailerController.onChangeSearchType}"
								update="@form"></p:ajax>
						</p:selectOneMenu>

					</h:panelGrid>
					<h:panelGrid columns="4"
						rendered="#{searchSaleForMailerController.searchByDateSaleRendered}">

						<p:outputLabel value="F. Venta Desde:"></p:outputLabel>
						<p:calendar navigator="true"
							value="#{searchSaleForMailerController.dateOfSaleStarted}" required="true"
							requiredMessage="Debe ingresar fecha venta desde:"
							pattern="dd-MM-yyyy"></p:calendar>

						<p:outputLabel value="F. Venta Hasta:"></p:outputLabel>
						<p:calendar navigator="true"
							value="#{searchSaleForMailerController.dateOfSaleEnded}" required="true"
							requiredMessage="Debe ingresar fecha venta hasta:"
							pattern="dd-MM-yyyy"></p:calendar>




						<p:outputLabel value="Banco:"></p:outputLabel>
						<p:selectOneMenu id="bank"
							value="#{searchSaleForMailerController.bankSelected}">
							<f:selectItem itemLabel="Seleccione..." itemValue="" />
							<f:selectItems value="#{searchSaleForMailerController.banks}"></f:selectItems>
						</p:selectOneMenu>

						<p:outputLabel value="Producto:"></p:outputLabel>
						<p:selectOneMenu id="product"
							value="#{searchSaleForMailerController.productSelected}">
							<f:selectItem itemLabel="Seleccione..." itemValue="" />
							<f:selectItems value="#{searchSaleForMailerController.products}"></f:selectItems>
						</p:selectOneMenu>

						<p:outputLabel value="F. Afiliacion"></p:outputLabel>
						<p:calendar navigator="true"
							value="#{searchSaleForMailerController.affiliationDate}"
							pattern="dd-MM-yyyy"></p:calendar>


						<p:outputLabel value="Estado:"></p:outputLabel>
						<p:selectOneMenu id="state"
							value="#{searchSaleForMailerController.saleStateSelected}">
							<f:selectItem itemLabel="Seleccione..." itemValue="" />
							<f:selectItems value="#{searchSaleForMailerController.saleStates}"></f:selectItems>
						</p:selectOneMenu>

					</h:panelGrid>

					<h:panelGrid columns="2"
						rendered="#{searchSaleForMailerController.searchByCreditCardNumberRendered}">

						<p:outputLabel value="NUM. TARJETA"></p:outputLabel>
						<p:inputText style="width: 120px;" required="true"
							requiredMessage="Debe ingresar NUM. TARJETA"
							value="#{searchSaleForMailerController.creditCardNumber}"></p:inputText>

					</h:panelGrid>

					<h:panelGrid columns="2"
						rendered="#{searchSaleForMailerController.searchByDocumentNumberResponsibleRendered}">
						<p:outputLabel value="DNI RESP."></p:outputLabel>
						<p:inputText style="width: 120px;" required="true"
							requiredMessage="Debe ingresar DNI RESP."
							value="#{searchSaleForMailerController.nuicResponsible}"></p:inputText>

					</h:panelGrid>


					<h:panelGrid columns="2"
						rendered="#{searchSaleForMailerController.searchByNamesRendered}">

						<p:outputLabel value="Tipo de persona:"></p:outputLabel>
						<p:selectOneMenu id="personType"
							value="#{searchSaleForMailerController.personTypeSelected}"
							required="true"
							requiredMessage="Debe seleccionar tipo de persona">
							<f:selectItem itemLabel="Seleccione..." itemValue="" />
							<f:selectItem itemLabel="Responsable" itemValue="responsible" />
							<f:selectItem itemLabel="Asegurado" itemValue="insured" />
							<f:selectItem itemLabel="Contratante" itemValue="contractor" />
							<p:ajax immediate="true"
								listener="#{searchSaleForMailerController.onChangePersonType}"
								update="@form"></p:ajax>
						</p:selectOneMenu>

					</h:panelGrid>

					<h:panelGrid columns="2"
						rendered="#{searchSaleForMailerController.searchByContractorRendered}">

						<p:outputLabel value="NUIC CONT."></p:outputLabel>
						<p:inputText style="width: 230px;"
							value="#{searchSaleForMailerController.nuicContractor}"></p:inputText>

						<p:outputLabel value="AP. PATERNO CONT."></p:outputLabel>
						<p:inputText style="width: 230px;"
							value="#{searchSaleForMailerController.lastnamePaternalContractor}"></p:inputText>

						<p:outputLabel value="AP. MATERNO CONT."></p:outputLabel>
						<p:inputText style="width: 230px;"
							value="#{searchSaleForMailerController.lastnameMaternalContractor}"></p:inputText>

						<p:outputLabel value="NOMBRES CONT."></p:outputLabel>
						<p:inputText style="width: 230px;"
							value="#{searchSaleForMailerController.firstnameContractor}"></p:inputText>

					</h:panelGrid>
					<h:panelGrid columns="2"
						rendered="#{searchSaleForMailerController.searchByInsuredRendered}">

						<p:outputLabel value="NUIC ASEG."></p:outputLabel>
						<p:inputText style="width: 230px;"
							value="#{searchSaleForMailerController.nuicInsured}"></p:inputText>

						<p:outputLabel value="AP. PATERNO ASEG."></p:outputLabel>
						<p:inputText style="width: 230px;"
							value="#{searchSaleForMailerController.lastnamePaternalInsured}"></p:inputText>

						<p:outputLabel value="AP. MATERNO ASEG."></p:outputLabel>
						<p:inputText style="width: 230px;"
							value="#{searchSaleForMailerController.lastnameMaternalInsured}"></p:inputText>

						<p:outputLabel value="NOMBRES ASEG."></p:outputLabel>
						<p:inputText style="width: 230px;"
							value="#{searchSaleForMailerController.firstnameInsured}"></p:inputText>
					</h:panelGrid>
					<h:panelGrid columns="2"
						rendered="#{searchSaleForMailerController.searchByResponsibleRendered}">

						<p:outputLabel value="NUIC RESP."></p:outputLabel>
						<p:inputText style="width: 230px;"
							value="#{searchSaleForMailerController.nuicResponsible}"></p:inputText>

						<p:outputLabel value="AP. PATERNO RESP."></p:outputLabel>
						<p:inputText style="width: 230px;"
							value="#{searchSaleForMailerController.lastnamePaternalResponsible}"></p:inputText>

						<p:outputLabel value="AP. MATERNO RESP."></p:outputLabel>
						<p:inputText style="width: 230px;"
							value="#{searchSaleForMailerController.lastnameMaternalResponsible}"></p:inputText>

						<p:outputLabel value="NOMBRES RESP."></p:outputLabel>
						<p:inputText style="width: 230px;"
							value="#{searchSaleForMailerController.firstnameResponsible}"></p:inputText>
					</h:panelGrid>
				</h:panelGrid>
				<h:panelGrid columns="2" style="margin:auto;text-align:center;">
					<p:commandButton icon="ui-icon-search"
						actionListener="#{searchSaleForMailerController.search}" value="Buscar"
						process="@form" update=":form:searchTable :form:messages">
					</p:commandButton>

					<p:commandButton action="#{searchSaleForMailerController.exportExcel}"
						value="Exportar a excel" process="@form" ajax="false">
					</p:commandButton>

				</h:panelGrid>
			</h:panelGrid>


			<h:panelGrid style="margin:auto;">

				<h:panelGrid columns="7">

					<p:commandButton id="mailingButtom"
						actionListener="#{searchSaleForMailerController.showMailings}"
						icon="ui-icon-pencil" value="Ver envíos por correo"
						oncomplete="PF('mailingsDialog').show()"
						update=":form:mailingsDetail"
						disabled="#{searchSaleForMailerController.saleSelected==null}">
					</p:commandButton>

					<p:outputLabel id="saleId"
						value="Venta seleccionada: #{searchSaleForMailerController.saleSelected!=null?searchSaleForMailerController.saleSelected.code:''}">
					</p:outputLabel>

				</h:panelGrid>

				<p:dataTable value="#{searchSaleForMailerController.sales}" var="s"
					scrollable="true" scrollWidth="800" paginator="true" rows="10"
					selectionMode="single"
					selection="#{searchSaleForMailerController.saleSelected}" rowKey="#{s.id}"
					id="searchTable">

					<p:ajax event="rowSelect"
						update=":form:mailingButtom :form:saleId" />
					<p:ajax event="rowUnselect"
						update=":form:mailingButtom :form:saleId" />


					<p:column headerText="CODIGO" width="100">
						<h:outputText value="#{s.code}"></h:outputText>
					</p:column>

					<p:column headerText="TIPO DE DOCUMENTO" width="80">
						<h:outputText value="#{s.documentType}"></h:outputText>
					</p:column>

					<p:column headerText="NUIC RESP PAGO" width="80">
						<h:outputText value="#{s.nuicResponsible}"></h:outputText>
					</p:column>

					<p:column headerText="AP PAT RESP PAGO" width="80">
						<h:outputText value="#{s.lastnamePaternalResponsible}"></h:outputText>
					</p:column>

					<p:column headerText="AP MAT RESP PAGO" width="80">
						<h:outputText value="#{s.lastnameMaternalResponsible}"></h:outputText>
					</p:column>

					<p:column headerText="NOMBRES RESP PAGO" width="80">
						<h:outputText value="#{s.firstnameResponsible}"></h:outputText>
					</p:column>

					<p:column headerText="N° TARJETA DE CREDITO" width="100">
						<h:outputText value="#{s.creditCardNumber}"></h:outputText>
					</p:column>

					<p:column headerText="N° DE CUENTA" width="80">
						<h:outputText value="#{s.accountNumber}"></h:outputText>
					</p:column>

					<p:column headerText="FECHA VENC TARJETA" width="80">
						<h:outputText value="#{s.creditCardExpirationDate}">
							<f:convertDateTime pattern="MM/yyyy" />
						</h:outputText>
					</p:column>

					<p:column headerText="ESTADO" width="80">
						<h:outputText value="#{s.creditCardState}"></h:outputText>
					</p:column>

					<p:column headerText="DIAS MORA" width="80">
						<h:outputText value="#{s.creditCardDaysOfDefault}"></h:outputText>
					</p:column>



					<p:column headerText="NUIC CONTRATANTE" width="80">
						<h:outputText value="#{s.nuicContractor}"></h:outputText>
					</p:column>

					<p:column headerText="AP PAT CONTRATANTE" width="80">
						<h:outputText value="#{s.lastnamePaternalContractor}"></h:outputText>
					</p:column>

					<p:column headerText="AP MAT CONTRATANTE" width="80">
						<h:outputText value="#{s.lastnameMaternalContractor}"></h:outputText>
					</p:column>

					<p:column headerText="NOMBRES CONTRATANTE" width="80">
						<h:outputText value="#{s.firstnameContractor}"></h:outputText>
					</p:column>


					<p:column headerText="NUIC ASEGURADO" width="80">
						<h:outputText value="#{s.nuicInsured}"></h:outputText>
					</p:column>

					<p:column headerText="AP PAT ASEGURADO" width="80">
						<h:outputText value="#{s.lastnamePaternalInsured}"></h:outputText>
					</p:column>

					<p:column headerText="AP MAT ASEGURADO" width="80">
						<h:outputText value="#{s.lastnameMaternalInsured}"></h:outputText>
					</p:column>

					<p:column headerText="NOMBRES ASEGURADO" width="80">
						<h:outputText value="#{s.firstnameInsured}"></h:outputText>
					</p:column>

					<p:column headerText="TELEFONO 1" width="80">
						<h:outputText value="#{s.phone1}"></h:outputText>
					</p:column>

					<p:column headerText="TELEFONO 2" width="80">
						<h:outputText value="#{s.phone2}"></h:outputText>
					</p:column>

					<p:column headerText="CORREO" width="120">
						<h:outputText value="#{s.mail}"></h:outputText>
					</p:column>

					<p:column headerText="DEPARTAMENTO" width="80">
						<h:outputText value="#{s.department}"></h:outputText>
					</p:column>

					<p:column headerText="PROVINCIA" width="80">
						<h:outputText value="#{s.province}"></h:outputText>
					</p:column>

					<p:column headerText="DISTRITO" width="80">
						<h:outputText value="#{s.district}"></h:outputText>
					</p:column>

					<p:column headerText="DIRECCION" width="120">
						<h:outputText value="#{s.address}"></h:outputText>
					</p:column>






					<p:column headerText="FECHA DE VENTA" width="80">
						<h:outputText value="#{s.dateOfSale}" width="80">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>

					<p:column headerText="CANAL DE VENTA" width="80">
						<h:outputText value="#{s.channelOfSale}"></h:outputText>
					</p:column>

					<p:column headerText="LUGAR DE VENTA" width="80">
						<h:outputText value="#{s.placeOfSale}"></h:outputText>
					</p:column>

					<p:column headerText="CODIGO DE VENDEDOR" width="80">
						<h:outputText value="#{s.vendorCode}"></h:outputText>
					</p:column>

					<p:column headerText="NOMBRE DE VENDEDOR" width="80">
						<h:outputText value="#{s.vendorName}"></h:outputText>
					</p:column>

					<p:column headerText="# DE POLIZA" width="80">
						<h:outputText value="#{s.policyNumber}"></h:outputText>
					</p:column>

					<p:column headerText="# DE CERTIFICADO" width="80">
						<h:outputText value="#{s.certificateNumber}"></h:outputText>
					</p:column>

					<p:column headerText="# DE PROPUESTA" width="80">
						<h:outputText value="#{s.proposalNumber}"></h:outputText>
					</p:column>

					<p:column headerText="CODIGO DE COMERCIO" width="80">
						<h:outputText value="#{s.commerce.code}"></h:outputText>
					</p:column>


					<p:column headerText="PRODUCTO" width="80">
						<h:outputText value="#{s.commerce.product.name}"></h:outputText>
					</p:column>

					<p:column headerText="DESCRIPCION DE PRODUCTO" width="80">
						<h:outputText value="#{s.productDescription}"></h:outputText>
					</p:column>

					<p:column headerText="PERIODO DE COBRO" width="80">
						<h:outputText value="#{s.collectionPeriod}"></h:outputText>
					</p:column>

					<p:column headerText="TIPO DE COBRO" width="80">
						<h:outputText value="#{s.collectionType}"></h:outputText>
					</p:column>

					<p:column headerText="MEDIO DE PAGO" width="80">
						<h:outputText value="#{s.commerce.paymentMethod.name}"></h:outputText>
					</p:column>

					<p:column headerText="PRIMA" width="80">
						<h:outputText value="#{s.insurancePremium}"></h:outputText>
					</p:column>

					<p:column headerText="FECHA DE AUDITORIA" width="80">
						<h:outputText value="#{s.auditDate}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>

					<p:column headerText="USUARIO DE AUDITORIA" width="80">
						<h:outputText value="#{s.auditUser}"></h:outputText>
					</p:column>

					<p:column headerText="ESTADO" width="80">
						<h:outputText value="#{s.saleState}"></h:outputText>
					</p:column>

					<p:column headerText="FECHA ESTADO" width="80">
						<h:outputText value="#{s.stateDate}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>

					<p:column headerText="USUARIO BAJA" width="80">
						<h:outputText value="#{s.downUser}"></h:outputText>
					</p:column>

					<p:column headerText="CANAL BAJA" width="80">
						<h:outputText value="#{s.downChannel}"></h:outputText>
					</p:column>

					<p:column headerText="MOTIVO BAJA" width="80">
						<h:outputText value="#{s.downReason}"></h:outputText>
					</p:column>

					<p:column headerText="OBSERVACION BAJA" width="80">
						<h:outputText value="#{s.downObservation}"></h:outputText>
					</p:column>

					<p:column headerText="FECHA ACT TC" width="80">
						<h:outputText value="#{s.creditCardUpdatedAt}" width="80">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>

					<p:column headerText="AFILIADO" width="80">
						<h:outputText value="#{s.affiliation==true?'Si':'No'}" width="80">
						</h:outputText>
					</p:column>

					<p:column headerText="FECHA DE AFILIACION" width="80">
						<h:outputText value="#{s.affiliationDate}" width="80">
							<f:convertDateTime pattern="dd/MM/yyyy hh:mm:ss" />
						</h:outputText>
					</p:column>

					<p:column headerText="AFILIADO USUARIO" width="80">
						<h:outputText value="#{s.affiliationUser.username}" width="80">
						</h:outputText>
					</p:column>

					<p:column headerText="BANCO" width="80">
						<h:outputText value="#{s.commerce.bank.name}"></h:outputText>
					</p:column>


					<p:column headerText="FECHA CREACION" width="80">
						<h:outputText value="#{s.createdAt}">
							<f:convertDateTime pattern="dd-MM-yyyy hh:mm:ss a" />
						</h:outputText>
					</p:column>

					<p:column headerText="USUARIO CREACION" width="80">
						<h:outputText value="#{s.user.username}"></h:outputText>
					</p:column>
					
					<p:column headerText="ACEPTO CONDICIONADO" width="80">
						<h:outputText value="#{s.conditioned}"></h:outputText>
					</p:column>
					
					<p:column headerText="ENVIOS CORREO" width="80">
						<h:outputText value="#{s.mailingRetries}"></h:outputText>
					</p:column>
					
					<p:column headerText="ENVIOS FÍSICOS" width="80">
						<h:outputText value="#{s.printingRetries}"></h:outputText>
					</p:column>


				</p:dataTable>

			</h:panelGrid>

			<p:dialog header="Envíos" widgetVar="mailingsDialog"
				showEffect="fade" hideEffect="fade" width="800" height="200">
				<p:outputPanel id="mailingsDetail" style="text-align:center;">

					<h:panelGrid style="margin:auto;">

						<p:dataTable value="#{searchSaleForMailerController.mailings}" var="s"
							paginator="true" rows="5" id="mailingsTable">


							<p:column headerText="CODIGO" width="100">
								<h:outputText value="#{s.code}"></h:outputText>
							</p:column>

							<p:column headerText="FECHA DE ENVIO" width="80">
								<h:outputText value="#{s.sendingAt}">
									<f:convertDateTime pattern="MM/yyyy" />
								</h:outputText>
							</p:column>
							
							<p:column headerText="FECHA DE RESPUESTA" width="80">
								<h:outputText value="#{s.answeringAt}">
									<f:convertDateTime pattern="MM/yyyy" />
								</h:outputText>
							</p:column>

							<p:column headerText="ESTADO" width="80">
								<h:outputText value="#{s.mailingState}"></h:outputText>
							</p:column>
							
							<p:column headerText="TIPO" width="80">
								<h:outputText value="#{s.mailingType}"></h:outputText>
							</p:column>


						</p:dataTable>

					</h:panelGrid>
				</p:outputPanel>
			</p:dialog>
		</h:form>


	</ui:define>

</ui:composition>
</html>
